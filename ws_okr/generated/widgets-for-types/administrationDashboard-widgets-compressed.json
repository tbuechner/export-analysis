[{"rows":[{"columns":[{"proportion":9,"widgets":[{"widgetType":"cf.platform.embeddedSearchAsTable","attributes":[{"name":"search","value":{"filters":[{"relativeSpace":"true"},{"types":["cf.cplace.solution.okr.cycle"]},{"not":{"and":[{"relativeSpace":"true"},{"types":["cf.cplace.solution.okr.cycle"]},{"uid":"page/e5xbc5szfvf7jh4471rv7qehq"}]}}]}},{"name":"title","value":{"de":"Alle Zyklen","en":"All Cycles"}}]}]},{"proportion":3,"widgets":[{"widgetType":"cf.cplace.platform.attributesGroup","attributes":[{"name":"cf.cplace.platform.attributesGroup.layout","value":{"widgetsLayout":{"rows":[{"columns":[{"proportion":12,"widgets":[{"configuration":[{"name":"cf.platform.quotedAttributeName","values":[{"string":"'cf.cplace.solution.okr.cycleTemplate'"}]}],"widgetType":"cf.platform.singleAttribute"}]}]}]}}},{"name":"cf.cplace.platform.attributesGroup.localizedTitle","value":{"de":"Cycle Template","en":"Cycle Template"}},{"name":"cf.cplace.platform.attributesGroup.pageSelection","value":"relative"},{"name":"cf.cplace.platform.attributesGroup.relativeSelection","value":"cf.cplace.solution.okr.settings"},{"name":"height","value":100.0}]},{"widgetType":"cf.platform.embeddedSearchAsTable","attributes":[{"name":"search","value":{"filters":[{"relativeSpace":"true"},{"types":["cf.cplace.solution.okr.cycle"]},{"customIncomingSubSearch":"cf.cplace.solution.okr.cycleTemplate","search":{"filters":[{"contentTypes":["page"]},{"types":["cf.cplace.solution.okr.settings"]},{"customIncomingSubSearch":"cf.cplace.solution.okr.settings","search":{"filters":[{"contentTypes":["page"]},{"types":["cf.cplace.solution.okr.administrationDashboard"]},{"relativeUid":"embeddingCustomEntity"}]}}]}}]}},{"name":"title","value":{"de":"Template","en":"Template"}}]}]}]},{"columns":[{"proportion":9,"widgets":[{"widgetType":"cf.cplace.platform.attributesGroup","attributes":[{"name":"cf.cplace.platform.attributesGroup.layout","value":{"widgetsLayout":{"rows":[{"columns":[{"proportion":12,"widgets":[{"configuration":[{"name":"cf.platform.quotedAttributeName","values":[{"string":"'cf.cplace.solution.okr.currentCycle'"}]}],"widgetType":"cf.platform.singleAttribute"}]}]}]}}},{"name":"cf.cplace.platform.attributesGroup.localizedTitle","value":{"de":"Current Cycle","en":"Current Cycle"}},{"name":"cf.cplace.platform.attributesGroup.pageSelection","value":"relative"},{"name":"cf.cplace.platform.attributesGroup.relativeSelection","value":"cf.cplace.solution.okr.settings"},{"name":"height","value":100.0}]}]},{"proportion":3,"widgets":[{"widgetType":"cf.cplace.lowCodeWidgets.lowCodeButton","attributes":[{"name":"cf.cplace.lowCodeWidgets.lowCodeButtonWidget.additionalDataAttributes","value":"cf.cplace.solution.okr.nextCycle"},{"name":"cf.cplace.lowCodeWidgets.lowCodeButtonWidget.additionalDataType","value":"cf.cplace.solution.okr.selectNextCycle"},{"name":"cf.cplace.lowCodeWidgets.lowCodeButtonWidget.additionalDataTypeDialogTitle","value":{"en":"Select next Cycle","de":"W\u00e4hle den n\u00e4chsten Zyklus"}},{"name":"cf.cplace.lowCodeWidgets.lowCodeButtonWidget.buttonLabel","value":{"de":"Change Cycle","en":"Change Cycle"}},{"name":"cf.cplace.lowCodeWidgets.lowCodeButtonWidget.dataSource","value":"search"},{"name":"cf.cplace.lowCodeWidgets.lowCodeButtonWidget.script","value":{"version":1,"script":"/// <reference path=\"../../typeDefinitions/cplaceJS_type.js\" />\n\n //--------------------------------------------------------------------------------------//\n //                                       CONFIGURATION                                  //\n //--------------------------------------------------------------------------------------//\n const DEBUG = true;\n\n const preventChange = false;\n\n //--------------------------------------------------------------------------------------//\n //                                       HELPER FUNCTIONS                               //\n //--------------------------------------------------------------------------------------//\n\n\n /**\n  * Log to cplace\n  * @param {any} text\n  */\n  function log(text) {\n    if (!DEBUG) {\n        return\n    }\n    let logOutput = (typeof text !== 'string') ? JSON.stringify(text) : text;\n\n    cplace.log(logOutput);\n}\n\n //--------------------------------------------------------------------------------------//\n //                                       BUSINESS FUNCTIONS                               //\n //--------------------------------------------------------------------------------------//\n\n function updateCurrentCycle(page, settingsPage) {\n   let editorGroups = settingsPage.get('cf.cplace.solution.okr.editors');\n\n   if (preventChange) {\n     return;\n   }\n    cplace.actions().updatePage(page, {\n        writers:  {\n            'additiveInheritance': false,\n            '-': editorGroups // remove these editors\n        },\n        customAttributes: {\n            'cf.cplace.solution.okr.status': '#35 Closed'\n        }\n    });\n }\n\n function updateNextCycle(page) {\n\n  if (preventChange) {\n    return;\n  }\n    setInitialDateOnKRs(page);\n    cplace.actions().updatePage(page, {\n        customAttributes: {\n            'cf.cplace.solution.okr.status': '#25 Current'\n        }\n    });\n }\n\n function setInitialDateOnKRs(cycle) {\n    let results = cycle.getIncomingPages('cf.cplace.solution.okr.progress', 'cf.cplace.solution.okr.cycle');\n\n    let now = new DateTime();\n    results.forEach(function(page) {\n      if (preventChange) {\n        return;\n      }\n        cplace.actions().updatePage(page, {\n            customAttributes: {\n                'cf.cplace.solution.okr.lastUpdate': now\n            }\n        });\n    });\n }\n\n\nreturn {\n    // \"checkAccess\" function will check if the button should be enabled given the current context\n    checkAccess: function() {\n        return true; // Allowed for all users\n    },\n    // \"call\" function contains the actual business logic and can optionally return an object\n    // containing a success message\n    call: function() {\n        log('Starting switch-to-next-cycle-script');\n\n        let settingsPage = embeddingPage.get('cf.cplace.solution.okr.settings');\n        log('Settings:' + settingsPage.getName());\n\n        let currentCycle = settingsPage.get('cf.cplace.solution.okr.currentCycle');\n        let nextCycle = additionalData.get('cf.cplace.solution.okr.nextCycle');\n\n        if (!currentCycle) {\n            return {\n                message: {\n                    de: 'Fehler in den Einstellungen, der aktuelle Zyklus ist nicht bekannt.',\n                    en: 'Error found in settings - the current cycle is not set.'\n                }\n            }\n        }\n\n        log('Current: ' + currentCycle.getName());\n        log('Next: ' + nextCycle.getName());\n\n        updateCurrentCycle(currentCycle, settingsPage);\n        updateNextCycle(nextCycle);\n\n\n        // Everything done, update internal reference\n        log('Update reference to next cycle');\n\n        if (!preventChange) {\n          cplace.actions().updatePage(settingsPage, {\n            customAttributes: {\n              'cf.cplace.solution.okr.currentCycle': nextCycle\n            }\n          });\n        }\n\n        return {\n           message: {\n             de: 'Erfolgreich beendet',\n             en: 'Finished successfully'\n           }\n        }\n    }\n}","upgradeAck":true,"description":""}},{"name":"cf.cplace.lowCodeWidgets.lowCodeButtonWidget.showConfirmationDialog","value":false},{"name":"cf.cplace.lowCodeWidgets.lowCodeButtonWidget.showFrame","value":false},{"name":"sortOrder","value":"Aufsteigend"}]}]}]},{"columns":[{"proportion":6,"widgets":[]},{"proportion":3,"widgets":[]},{"proportion":3,"widgets":[]}]},{"columns":[{"proportion":6,"widgets":[]},{"proportion":6,"widgets":[]}]}],"layoutType":"typeDefinitionLayout","internalLayoutName":"cf.cplace.solution.okr.layout.cycles","localizedLayoutName":{"de":"Cycle","en":"Cycles"},"typeName":"cf.cplace.solution.okr.administrationDashboard"},{"rows":[{"columns":[{"proportion":12,"widgets":[{"widgetType":"cf.platform.embeddedSearchAsTable","attributes":[{"name":"groupColumn","value":"'cf.cplace.solution.okr.organizationalUnit'"},{"name":"search","value":{"filters":[{"relativeSpace":"true"},{"types":["cf.cplace.solution.okr.organizationalUnit"]}]}},{"name":"title","value":{"de":"Organisationseinheiten","en":"Organizational Units"}}]}]}]}],"layoutType":"typeDefinitionLayout","internalLayoutName":"cf.cplace.solution.okr.layout.organizationalUnits","localizedLayoutName":{"de":"Organisationseinheiten","en":"Organizational Units"},"typeName":"cf.cplace.solution.okr.administrationDashboard"},{"rows":[{"columns":[{"proportion":6,"widgets":[{"widgetType":"cf.cplace.platform.attributesGroup","attributes":[{"name":"cf.cplace.platform.attributesGroup.layout","value":{"widgetsLayout":{"rows":[{"columns":[{"proportion":12,"widgets":[{"configuration":[{"name":"cf.cplace.platform.heading.localizedHeading","values":[{"localizedString":"{\"de\":\"Berechtigungen\",\"en\":\"Permissions\"}"}]},{"name":"cf.cplace.platform.heading.size","values":[{"string":"h3"}]}],"widgetType":"cf.cplace.platform.heading"},{"configuration":[{"name":"cf.platform.quotedAttributeName","values":[{"string":"'cf.cplace.solution.okr.reader'"}]}],"widgetType":"cf.platform.singleAttribute"},{"configuration":[{"name":"cf.platform.quotedAttributeName","values":[{"string":"'cf.cplace.solution.okr.editors'"}]}],"widgetType":"cf.platform.singleAttribute"}]}]}]}}},{"name":"cf.cplace.platform.attributesGroup.localizedTitle","value":{"de":"Berechtigungen","en":"Permissions"}},{"name":"cf.cplace.platform.attributesGroup.pageSelection","value":"relative"},{"name":"cf.cplace.platform.attributesGroup.relativeSelection","value":"cf.cplace.solution.okr.settings"},{"name":"height","value":225.0}]}]},{"proportion":6,"widgets":[]}]},{"columns":[{"proportion":12,"widgets":[]}]}],"layoutType":"typeDefinitionLayout","internalLayoutName":"cf.cplace.solution.okr.layout.permissions","localizedLayoutName":{"de":"Berechtigungen","en":"Permissions"},"typeName":"cf.cplace.solution.okr.administrationDashboard"},{"rows":[{"columns":[{"proportion":4,"widgets":[{"widgetType":"cf.platform.embeddedSearchAsTable","attributes":[{"name":"search","value":{"filters":[{"relativeSpace":"true"},{"types":["cf.cplace.solution.okr.cycle"]},{"customIncomingSubSearch":"cf.cplace.solution.okr.cycleTemplate","search":{"filters":[{"contentTypes":["page"]},{"types":["cf.cplace.solution.okr.settings"]},{"customIncomingSubSearch":"cf.cplace.solution.okr.settings","search":{"filters":[{"contentTypes":["page"]},{"types":["cf.cplace.solution.okr.administrationDashboard"]},{"relativeUid":"embeddingCustomEntity"}]}}]}}]}},{"name":"title","value":{"de":"Cycle Templates","en":"Cycle Templates"}}]}]},{"proportion":8,"widgets":[{"widgetType":"cf.platform.embeddedSearchAsTable","attributes":[{"name":"connectedTableWidgetId","value":"_n945zpo7e1fd3oh81rcs3jp44"},{"name":"search","value":{"filters":[{"relativeSpace":"true"},{"types":["cf.cplace.solution.okr.set"]},{"relativeCustomReference":"cf.cplace.solution.okr.cycle","referenceOperator":"connectedTable"}]}},{"name":"title","value":{"de":"Set zum ausgew\u00e4hlten Cycle","en":"Set of selected Cycle"}}]}]}]}],"layoutType":"typeDefinitionLayout","internalLayoutName":"cf.cplace.solution.okr.layout.template","localizedLayoutName":{"de":"Template","en":"Template"},"typeName":"cf.cplace.solution.okr.administrationDashboard"},{"rows":[{"columns":[{"proportion":12,"widgets":[{"widgetType":"cf.cplace.demoWidgets.demoRichString","attributes":[{"name":"content","value":"<p><_embeddedwidget_></p>"},{"name":"localizedWidgetTitle","value":{"de":"Administration Banner","en":"Administration Banner"}}]},{"widgetType":"cf.cplace.layoutTabsWidget.widget","attributes":[{"name":"cf.cplace.layoutTabsWidget.cplacejsLayouts","value":{"version":1,"script":"var layoutConfig = {\n    layouts: selectedLayouts,\n    active: selectedActiveLayout\n};\n\nreturn layoutConfig;","upgradeAck":true,"description":""}},{"name":"cf.cplace.layoutTabsWidget.layoutSelection","value":"cf.cplace.solution.okr.layout.cycles"},{"name":"cf.cplace.layoutTabsWidget.layouts","value":{"layouts":["cf.cplace.solution.okr.layout.cycles","cf.cplace.solution.okr.layout.template","cf.cplace.solution.okr.layout.organizationalUnits","cf.cplace.solution.okr.layout.permissions","cf.cplace.solution.okr.layout.settings"]}},{"name":"cf.cplace.layoutTabsWidget.sourceForLayouts","value":"simpleLayoutSelection"}]}]}]}],"layoutType":"typeLayout","typeName":"cf.cplace.solution.okr.administrationDashboard"}]